# 数据库管理指南

本文档提供日程计划助手应用的数据库管理操作指南。

## 数据库概述

- 数据库类型: SQLite3
- 数据库文件: `database.sqlite`
- ORM: Sequelize

## 数据库操作命令

服务器不再自动同步数据库结构，需要手动执行以下命令进行数据库管理：

### 数据库同步（安全更新）

当模型结构发生变化后，使用以下命令更新数据库结构，会尽量保留现有数据：

```bash
npm run db:sync
```

此命令使用 Sequelize 的 `alter: true` 选项，会尝试在保留数据的同时更新表结构。

### 数据库重置（完全重建）

如需完全重建数据库（会删除所有现有数据），使用以下命令：

```bash
npm run db:reset
```

**警告：此操作会清空所有数据，请在执行前进行备份！**

## 数据库备份

建议定期备份 SQLite 数据库文件：

```bash
# 复制数据库文件
cp database.sqlite database.sqlite.backup-$(date +%Y%m%d)
```

## 数据库故障排除

如果遇到数据库结构错误或索引冲突，可以尝试以下步骤：

1. 备份数据库文件
2. 尝试使用安全同步命令
   ```bash
   npm run db:sync
   ```
3. 如果仍有问题，且数据可以丢失，使用重置命令
   ```bash
   npm run db:reset
   ```

## 数据库迁移

当前系统未使用 Sequelize 的迁移功能。如需在将来添加更复杂的数据库更改，可以考虑实现正式的迁移机制。 